{# templates/public_outfits/index.html.twig #}

{% extends 'base.html.twig' %}

{% block body %}
	<h1 class="text-2xl font-bold mb-4 dark:text-white">Outfits Publics</h1>

	<form method="get" class="mb-4 flex gap-2">
		<input type="text" name="search" value="{{ search }}" placeholder="Recherche par nom" class="border p-2 rounded dark:bg-gray-700 dark:text-white dark:border-gray-600 ml-4 mr-4">

		<select name="category" class=" ml-4 mr-4 border p-2 rounded dark:bg-gray-700 dark:text-white dark:border-gray-600">
			<option value="">Toutes les cat√©gories</option>
			{% for category in categories %}
				<option value="{{ category.category }}" {% if categoryFilter == category.category %} selected {% endif %}>
					{{ category.category }}
				</option>
			{% endfor %}
		</select>

		<button type="submit" class="bg-blue-500 dark:bg-blue-600 text-white p-2 rounded hover:bg-blue-600 dark:hover:bg-blue-500">
			Rechercher
		</button>
	</form>

	{% if outfits is not empty %}
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
			{% for outfit in outfits %}
				<div class="border p-4 rounded-lg shadow-lg bg-white dark:bg-gray-800 dark:text-gray-300">
					<h2 class="text-lg font-semibold dark:text-white">{{ outfit.name }}</h2>
					<p class="text-gray-600 dark:text-gray-400">Cr√©√© le:
						{{ outfit.createdAt|date('d/m/Y') }}</p>

					<div class="mt-4">
						<ul class="space-y-4">
							{% for clothing in outfit.items %}
								<li class="bg-gray-100 dark:bg-gray-700 p-2 rounded flex items-center">
									{% if clothing.image %}
										<img src="{{ asset(clothing.image) }}" alt="{{ clothing.name }}" class="w-[100px] h-[100px] object-cover mr-4">
									{% endif %}

									<div>
										<strong class="dark:text-white">{{ clothing.name }}</strong><br>
										<span class="dark:text-gray-300">
											Cat√©gorie :
											{{ clothing.category }}
										</span><br>
									</div>
								</li>
							{% endfor %}
						</ul>
					</div>

					<div class="mt-4 flex items-center justify-between">
						<span id="likes-count-{{ outfit.id }}" class="text-gray-600 dark:text-gray-400">
							üëç
							{{ outfit.likes|length }}
							Likes
						</span>
						<button class="bg-red-500 dark:bg-red-600 text-white p-2 rounded hover:bg-red-600 dark:hover:bg-red-500" onclick="toggleLike({{ outfit.id }})">
							Like ‚ù§Ô∏è
						</button>
					</div>

					<div class="mt-4">
						<h3 class="font-semibold dark:text-white">Commentaires</h3>
						<ul class="space-y-4">
							{% for comment in outfit.comments %}
								<li class="bg-gray-100 dark:bg-gray-700 p-2 rounded">
									<p class="dark:text-white">{{ comment.owner.name }} : {{ comment.content }}</p>
									<p class="text-sm text-gray-500 dark:text-gray-400">{{ comment.createdAt|date('d/m/Y H:i') }}</p>
								</li>
							{% else %}
								<p class="text-gray-500 dark:text-gray-400">Aucun commentaire pour cet outfit.</p>
							{% endfor %}
						</ul>
					</div>

					<div class="mt-4">
						<h3 class="font-semibold dark:text-white">Ajouter un commentaire</h3>
						<form action="{{ path('comment_create', {'outfitId': outfit.id}) }}" method="post" class="flex flex-col gap-2">
							<textarea name="content" placeholder="√âcrivez votre commentaire ici..." class="border p-2 rounded dark:bg-gray-700 dark:text-white dark:border-gray-600" required></textarea>
							<button type="submit" class="bg-green-500 dark:bg-green-600 text-white p-2 rounded hover:bg-green-600 dark:hover:bg-green-500">
								Publier le commentaire
							</button>
						</form>
					</div>

				</div>
			{% endfor %}
		</div>
	{% else %}
		<p class="dark:text-gray-300">Aucun outfit public trouv√©.</p>
	{% endif %}

<script>
    function toggleLike(outfitId) {
        fetch(`/like/${outfitId}`, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            console.log(response);
            if (response.redirected) {
                window.location.href = response.url;
                return;
            }

            return response.json();
        })
        .then(data => {
            if (data && data.likesCount !== undefined) {
                document.getElementById(`likes-count-${outfitId}`).textContent = `üëç ${data.likesCount} Likes`;
            }
        })
        .catch(error => console.error('Error:', error));
    }
</script>

{% endblock %}
